#!/usr/bin/env python

from testify import *
from untwisted import event

# Call then throw

sample = event.event()
equal(sample('Call then throw'), sample)

try:
  ok(False, sample.throw(Exception('Call then throw')))

except StopIteration:
  pass

# Connect
sample = event.event()
equal(sample.connect('Connect'), sample)

# Throw then call

sample = event.event()
equal(sample.throw(Exception('Throw then call')), sample)

try:
  ok(False, sample('Throw then call'))

except StopIteration:
  pass

# Supress traceback

@sample.connect
class ignore:

  @staticmethod
  def throw(*args, **kwds):
    pass

@event.connect
def connectThenCall():
  expect(1)

  equal((yield event.event()), 'Connect then call')

test(lambda: connectThenCall()('Connect then call'))

@test
@event.connect
def callThenConnect():
  expect(1)

  sample = event.event()
  sample('Call then connect')
  equal((yield sample), 'Call then connect')

@event.connect
def connectThenThrow():
  expect(1)

  try:
    ok(False, (yield event.event()))

  except:
    ok(True)

test(lambda: connectThenThrow().throw(Exception('Connect then throw')))

@test
@event.connect
def throwThenConnect():
  expect(1)

  sample = event.event()
  sample.throw(Exception('Throw then connect'))

  try:
    ok(False, (yield sample))

  except:
    ok(True)
